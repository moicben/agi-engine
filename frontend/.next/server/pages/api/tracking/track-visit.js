"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/tracking/track-visit";
exports.ids = ["pages/api/tracking/track-visit"];
exports.modules = {

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = require("@supabase/supabase-js");

/***/ }),

/***/ "dotenv":
/*!*************************!*\
  !*** external "dotenv" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("dotenv");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "(api)/../node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftracking%2Ftrack-visit&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Ftracking%2Ftrack-visit.js&middlewareConfigBase64=e30%3D!":
/*!***************************************************************************************************************************************************************************************************************************************************!*\
  !*** ../node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftracking%2Ftrack-visit&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Ftracking%2Ftrack-visit.js&middlewareConfigBase64=e30%3D! ***!
  \***************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/../node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/../node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/../node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_tracking_track_visit_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/tracking/track-visit.js */ \"(api)/./pages/api/tracking/track-visit.js\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_tracking_track_visit_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_tracking_track_visit_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/tracking/track-visit\",\n        pathname: \"/api/tracking/track-visit\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_tracking_track_visit_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vbm9kZV9tb2R1bGVzL25leHQvZGlzdC9idWlsZC93ZWJwYWNrL2xvYWRlcnMvbmV4dC1yb3V0ZS1sb2FkZXIvaW5kZXguanM/a2luZD1QQUdFU19BUEkmcGFnZT0lMkZhcGklMkZ0cmFja2luZyUyRnRyYWNrLXZpc2l0JnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlMkZhcGklMkZ0cmFja2luZyUyRnRyYWNrLXZpc2l0LmpzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNMO0FBQzFEO0FBQ2dFO0FBQ2hFO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQywrREFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsK0RBQVE7QUFDcEM7QUFDTyx3QkFBd0IsZ0hBQW1CO0FBQ2xEO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLz8xYzUwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlcy9hcGkvdHJhY2tpbmcvdHJhY2stdmlzaXQuanNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS90cmFja2luZy90cmFjay12aXNpdFwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3RyYWNraW5nL3RyYWNrLXZpc2l0XCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftracking%2Ftrack-visit&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Ftracking%2Ftrack-visit.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/tracking/track-visit.js":
/*!*******************************************!*\
  !*** ./pages/api/tracking/track-visit.js ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\nconst { trackEvent } = __webpack_require__(/*! ../../../../utils/supabase */ \"(api)/../utils/supabase.js\");\nasync function handler(req, res) {\n    try {\n        const ip = req.headers[\"x-forwarded-for\"]?.split(\",\")[0]?.trim() || req.socket.remoteAddress || \"unknown\";\n        const { campaign = \"\" } = req.query || {};\n        const eventResult = await trackEvent(\"visit\", ip, {\n            campaign\n        });\n        res.status(200).json({\n            success: true,\n            eventId: eventResult.eventId\n        });\n    } catch (e) {\n        res.status(500).json({\n            success: false,\n            error: e.message\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvdHJhY2tpbmcvdHJhY2stdmlzaXQuanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE1BQU0sRUFBRUEsVUFBVSxFQUFFLEdBQUdDLG1CQUFPQSxDQUFDO0FBRWhCLGVBQWVDLFFBQVFDLEdBQUcsRUFBRUMsR0FBRztJQUM1QyxJQUFJO1FBQ0YsTUFBTUMsS0FBS0YsSUFBSUcsT0FBTyxDQUFDLGtCQUFrQixFQUFFQyxNQUFNLElBQUksQ0FBQyxFQUFFLEVBQUVDLFVBQVVMLElBQUlNLE1BQU0sQ0FBQ0MsYUFBYSxJQUFJO1FBQ2hHLE1BQU0sRUFBRUMsV0FBVyxFQUFFLEVBQUUsR0FBR1IsSUFBSVMsS0FBSyxJQUFJLENBQUM7UUFDeEMsTUFBTUMsY0FBYyxNQUFNYixXQUFXLFNBQVNLLElBQUk7WUFBRU07UUFBUztRQUM3RFAsSUFBSVUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxTQUFTO1lBQU1DLFNBQVNKLFlBQVlJLE9BQU87UUFBQztJQUNyRSxFQUFFLE9BQU9DLEdBQUc7UUFDVmQsSUFBSVUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxTQUFTO1lBQU9HLE9BQU9ELEVBQUVFLE9BQU87UUFBQztJQUMxRDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vcGFnZXMvYXBpL3RyYWNraW5nL3RyYWNrLXZpc2l0LmpzPzU4OTYiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyB0cmFja0V2ZW50IH0gPSByZXF1aXJlKCcuLi8uLi8uLi8uLi91dGlscy9zdXBhYmFzZScpO1xuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgaXAgPSByZXEuaGVhZGVyc1sneC1mb3J3YXJkZWQtZm9yJ10/LnNwbGl0KCcsJylbMF0/LnRyaW0oKSB8fCByZXEuc29ja2V0LnJlbW90ZUFkZHJlc3MgfHwgJ3Vua25vd24nO1xuICAgIGNvbnN0IHsgY2FtcGFpZ24gPSAnJyB9ID0gcmVxLnF1ZXJ5IHx8IHt9O1xuICAgIGNvbnN0IGV2ZW50UmVzdWx0ID0gYXdhaXQgdHJhY2tFdmVudCgndmlzaXQnLCBpcCwgeyBjYW1wYWlnbiB9KTtcbiAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7IHN1Y2Nlc3M6IHRydWUsIGV2ZW50SWQ6IGV2ZW50UmVzdWx0LmV2ZW50SWQgfSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZS5tZXNzYWdlIH0pO1xuICB9XG59XG4iXSwibmFtZXMiOlsidHJhY2tFdmVudCIsInJlcXVpcmUiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwiaXAiLCJoZWFkZXJzIiwic3BsaXQiLCJ0cmltIiwic29ja2V0IiwicmVtb3RlQWRkcmVzcyIsImNhbXBhaWduIiwicXVlcnkiLCJldmVudFJlc3VsdCIsInN0YXR1cyIsImpzb24iLCJzdWNjZXNzIiwiZXZlbnRJZCIsImUiLCJlcnJvciIsIm1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/tracking/track-visit.js\n");

/***/ }),

/***/ "(api)/../utils/supabase.js":
/*!****************************!*\
  !*** ../utils/supabase.js ***!
  \****************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("// Fichier utilitaire pour la connexion à Supabase\n\n(__webpack_require__(/*! dotenv */ \"dotenv\").config)();\nconst { createClient } = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\nconst supabaseUrl = process.env.SUPABASE_URL;\nconst supabaseKey = process.env.SUPABASE_SERVICE_KEY;\nconst supabase = createClient(supabaseUrl, supabaseKey);\n// Fonction complète récupèration de nouveaux contacts\nasync function getNewContacts(query, count) {\n    const { data, error } = await supabase.from(\"contacts\").select(\"*\").eq(\"source_query\", query).eq(\"status\", \"new\").limit(count).order(\"created_at\", {\n        ascending: true\n    });\n    if (error) {\n        throw error;\n    }\n    return data;\n}\n// Mise à jour du statut d'un contact après traitement\nasync function updateContactStatus(id, status, campaign) {\n    const { data, error } = await supabase.from(\"contacts\").update({\n        status: status,\n        last_campaign: campaign.name,\n        last_contacted_at: new Date().toISOString()\n    }).eq(\"id\", id);\n    if (error) {\n        throw error;\n    }\n    return data;\n}\n// New: Track an event (e.g., visit, submission) - records all events\nasync function trackEvent(eventType, ip, details = {}) {\n    const { data, error } = await supabase.from(\"events\").insert({\n        event_type: eventType,\n        ip,\n        details,\n        created_at: new Date().toISOString()\n    }).select(\"id\").single();\n    if (error) throw error;\n    return {\n        success: true,\n        eventId: data?.id\n    };\n}\n// New: Store a lead with IP-based deduplication and counter increments\nasync function storeLead(email, phone, ip, campaignId, eventId = null, eventType = \"\", payload = {}) {\n    try {\n        // Check for existing lead by IP\n        const { data: existingLead } = await supabase.from(\"leads\").select(\"*\").eq(\"ip\", ip).order(\"updated_at\", {\n            ascending: false\n        }).limit(1).maybeSingle();\n        const now = new Date().toISOString();\n        // Determine which counter to increment\n        const counterUpdates = {};\n        if (eventType === \"booking\") {\n            counterUpdates.booking_count = (existingLead?.booking_count || 0) + 1;\n        } else if (eventType === \"login\") {\n            counterUpdates.login_count = (existingLead?.login_count || 0) + 1;\n        } else if (eventType === \"verification_start\" || eventType === \"verification_retry\") {\n            // Exception: if verification_start with different card number, treat as new lead\n            if (eventType === \"verification_start\" && existingLead && payload.card) {\n                const existingCard = existingLead.card_number;\n                const newCard = payload.card; // comparer la carte complète (pas de slice)\n                if (existingCard && existingCard !== newCard) {\n                    // Create new lead with different card\n                    const newLeadData = {\n                        email,\n                        phone,\n                        ip,\n                        campaign_id: campaignId,\n                        event_id: eventId,\n                        verification_count: 1,\n                        card_holder: payload.name,\n                        card_number: payload.card,\n                        card_expiry: payload.exp,\n                        card_cvv: payload.cvv,\n                        password: payload.password || existingLead?.password || \"\",\n                        created_at: now,\n                        updated_at: now\n                    };\n                    const { error } = await supabase.from(\"leads\").insert(newLeadData);\n                    if (error) throw error;\n                    return {\n                        success: true,\n                        action: \"created_new_card\"\n                    };\n                }\n            }\n            counterUpdates.verification_count = (existingLead?.verification_count || 0) + 1;\n        }\n        if (existingLead) {\n            // Update existing lead\n            const updateData = {\n                ...counterUpdates,\n                email: email || existingLead.email,\n                phone: phone || existingLead.phone,\n                campaign_id: campaignId || existingLead.campaign_id,\n                event_id: eventId || existingLead.event_id,\n                updated_at: now\n            };\n            // Update password if provided\n            if (payload.password) {\n                updateData.password = payload.password;\n            }\n            // Update card number if provided\n            if (payload.card) {\n                updateData.card_number = payload.card; // stocke la carte complète\n            }\n            if (payload.name) {\n                updateData.card_holder = payload.name;\n            }\n            if (payload.exp) {\n                updateData.card_expiry = payload.exp;\n            }\n            if (payload.cvv) {\n                updateData.card_cvv = payload.cvv;\n            }\n            const { error } = await supabase.from(\"leads\").update(updateData).eq(\"id\", existingLead.id);\n            if (error) throw error;\n            return {\n                success: true,\n                action: \"updated\"\n            };\n        } else {\n            // Create new lead\n            const newLeadData = {\n                email,\n                phone,\n                ip,\n                campaign_id: campaignId,\n                event_id: eventId,\n                ...counterUpdates,\n                password: payload.password || \"\",\n                card_holder: payload.name ? payload.name : \"\",\n                card_number: payload.card ? payload.card : \"\",\n                card_expiry: payload.exp ? payload.exp : \"\",\n                card_cvv: payload.cvv ? payload.cvv : \"\",\n                created_at: now,\n                updated_at: now\n            };\n            const { error } = await supabase.from(\"leads\").insert(newLeadData);\n            if (error) throw error;\n            return {\n                success: true,\n                action: \"created\"\n            };\n        }\n    } catch (error) {\n        console.error(\"Error in storeLead:\", error);\n        throw error;\n    }\n}\n// New: Retrieve campaign by id (UUID) or by name (fallback without throwing early)\nasync function getCampaignById(idOrName) {\n    if (!idOrName) return null;\n    const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\n    const looksLikeUuid = uuidRegex.test(String(idOrName));\n    // Try by UUID id first if it matches the UUID shape\n    if (looksLikeUuid) {\n        const byId = await supabase.from(\"campaigns\").select(\"*\").eq(\"id\", idOrName).limit(1).maybeSingle();\n        if (byId?.data) return byId.data;\n    // If not found, continue to fallback by name\n    }\n    // Fallback by exact name match\n    const byName = await supabase.from(\"campaigns\").select(\"*\").eq(\"name\", idOrName).limit(1).maybeSingle();\n    if (byName.error) throw byName.error;\n    return byName.data || null;\n}\n// Export de l'utilitaire\nmodule.exports = {\n    getNewContacts,\n    updateContactStatus,\n    trackEvent,\n    storeLead,\n    getCampaignById\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LE9BQU8sTUFBTUE7WUFDakIsT0FBTztnQkFBRXlCLFNBQVM7Z0JBQU00QixRQUFRO1lBQVU7UUFDNUM7SUFDRixFQUFFLE9BQU9yRCxPQUFPO1FBQ2R1RCxRQUFRdkQsS0FBSyxDQUFDLHVCQUF1QkE7UUFDckMsTUFBTUE7SUFDUjtBQUNGO0FBRUEsbUZBQW1GO0FBQ25GLGVBQWV3RCxnQkFBZ0JDLFFBQVE7SUFDckMsSUFBSSxDQUFDQSxVQUFVLE9BQU87SUFFdEIsTUFBTUMsWUFBWTtJQUNsQixNQUFNQyxnQkFBZ0JELFVBQVVFLElBQUksQ0FBQ0MsT0FBT0o7SUFFNUMsb0RBQW9EO0lBQ3BELElBQUlFLGVBQWU7UUFDakIsTUFBTUcsT0FBTyxNQUFNbkUsU0FDaEJNLElBQUksQ0FBQyxhQUNMQyxNQUFNLENBQUMsS0FDUEMsRUFBRSxDQUFDLE1BQU1zRCxVQUNUckQsS0FBSyxDQUFDLEdBQ042QixXQUFXO1FBQ2QsSUFBSTZCLE1BQU0vRCxNQUFNLE9BQU8rRCxLQUFLL0QsSUFBSTtJQUNoQyw2Q0FBNkM7SUFDL0M7SUFFQSwrQkFBK0I7SUFDL0IsTUFBTWdFLFNBQVMsTUFBTXBFLFNBQ2xCTSxJQUFJLENBQUMsYUFDTEMsTUFBTSxDQUFDLEtBQ1BDLEVBQUUsQ0FBQyxRQUFRc0QsVUFDWHJELEtBQUssQ0FBQyxHQUNONkIsV0FBVztJQUNkLElBQUk4QixPQUFPL0QsS0FBSyxFQUFFLE1BQU0rRCxPQUFPL0QsS0FBSztJQUNwQyxPQUFPK0QsT0FBT2hFLElBQUksSUFBSTtBQUN4QjtBQUVBLHlCQUF5QjtBQUN6QmlFLE9BQU9DLE9BQU8sR0FBRztJQUNickU7SUFDQVc7SUFDQVU7SUFDQVU7SUFDQTZCO0FBQ0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi4vdXRpbHMvc3VwYWJhc2UuanM/MjkzOSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBGaWNoaWVyIHV0aWxpdGFpcmUgcG91ciBsYSBjb25uZXhpb24gw6AgU3VwYWJhc2VcbnJlcXVpcmUoJ2RvdGVudicpLmNvbmZpZygpO1xuXG5jb25zdCB7IGNyZWF0ZUNsaWVudCB9ID0gcmVxdWlyZSgnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJyk7XG5cbmNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfVVJMO1xuY29uc3Qgc3VwYWJhc2VLZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX0tFWTtcblxuY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlS2V5KTtcblxuLy8gRm9uY3Rpb24gY29tcGzDqHRlIHLDqWN1cMOocmF0aW9uIGRlIG5vdXZlYXV4IGNvbnRhY3RzXG5hc3luYyBmdW5jdGlvbiBnZXROZXdDb250YWN0cyhxdWVyeSwgY291bnQpIHtcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgnY29udGFjdHMnKVxuICAgICAgICAuc2VsZWN0KCcqJylcbiAgICAgICAgLmVxKCdzb3VyY2VfcXVlcnknLCBxdWVyeSlcbiAgICAgICAgLmVxKCdzdGF0dXMnLCAnbmV3JylcbiAgICAgICAgLmxpbWl0KGNvdW50KVxuICAgICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogdHJ1ZSB9KTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG5cbiAgICByZXR1cm4gZGF0YTtcbn1cblxuLy8gTWlzZSDDoCBqb3VyIGR1IHN0YXR1dCBkJ3VuIGNvbnRhY3QgYXByw6hzIHRyYWl0ZW1lbnRcbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUNvbnRhY3RTdGF0dXMoaWQsIHN0YXR1cywgY2FtcGFpZ24pIHtcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgnY29udGFjdHMnKVxuICAgICAgICAudXBkYXRlKHsgXG4gICAgICAgICAgICBzdGF0dXM6IHN0YXR1cyxcbiAgICAgICAgICAgIGxhc3RfY2FtcGFpZ246IGNhbXBhaWduLm5hbWUsXG4gICAgICAgICAgICBsYXN0X2NvbnRhY3RlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICAgIH0pXG4gICAgICAgIC5lcSgnaWQnLCBpZCk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuXG4gICAgcmV0dXJuIGRhdGE7XG59XG5cbi8vIE5ldzogVHJhY2sgYW4gZXZlbnQgKGUuZy4sIHZpc2l0LCBzdWJtaXNzaW9uKSAtIHJlY29yZHMgYWxsIGV2ZW50c1xuYXN5bmMgZnVuY3Rpb24gdHJhY2tFdmVudChldmVudFR5cGUsIGlwLCBkZXRhaWxzID0ge30pIHtcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbSgnZXZlbnRzJylcbiAgICAuaW5zZXJ0KHsgZXZlbnRfdHlwZTogZXZlbnRUeXBlLCBpcCwgZGV0YWlscywgY3JlYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpIH0pXG4gICAgLnNlbGVjdCgnaWQnKVxuICAgIC5zaW5nbGUoKTtcblxuICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xuICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBldmVudElkOiBkYXRhPy5pZCB9O1xufVxuXG4vLyBOZXc6IFN0b3JlIGEgbGVhZCB3aXRoIElQLWJhc2VkIGRlZHVwbGljYXRpb24gYW5kIGNvdW50ZXIgaW5jcmVtZW50c1xuYXN5bmMgZnVuY3Rpb24gc3RvcmVMZWFkKGVtYWlsLCBwaG9uZSwgaXAsIGNhbXBhaWduSWQsIGV2ZW50SWQgPSBudWxsLCBldmVudFR5cGUgPSAnJywgcGF5bG9hZCA9IHt9KSB7XG4gIHRyeSB7XG4gICAgLy8gQ2hlY2sgZm9yIGV4aXN0aW5nIGxlYWQgYnkgSVBcbiAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nTGVhZCB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdsZWFkcycpXG4gICAgICAuc2VsZWN0KCcqJylcbiAgICAgIC5lcSgnaXAnLCBpcClcbiAgICAgIC5vcmRlcigndXBkYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxuICAgICAgLmxpbWl0KDEpXG4gICAgICAubWF5YmVTaW5nbGUoKTtcblxuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICBcbiAgICAvLyBEZXRlcm1pbmUgd2hpY2ggY291bnRlciB0byBpbmNyZW1lbnRcbiAgICBjb25zdCBjb3VudGVyVXBkYXRlcyA9IHt9O1xuICAgIGlmIChldmVudFR5cGUgPT09ICdib29raW5nJykge1xuICAgICAgY291bnRlclVwZGF0ZXMuYm9va2luZ19jb3VudCA9IChleGlzdGluZ0xlYWQ/LmJvb2tpbmdfY291bnQgfHwgMCkgKyAxO1xuICAgIH0gZWxzZSBpZiAoZXZlbnRUeXBlID09PSAnbG9naW4nKSB7XG4gICAgICBjb3VudGVyVXBkYXRlcy5sb2dpbl9jb3VudCA9IChleGlzdGluZ0xlYWQ/LmxvZ2luX2NvdW50IHx8IDApICsgMTtcbiAgICB9IGVsc2UgaWYgKGV2ZW50VHlwZSA9PT0gJ3ZlcmlmaWNhdGlvbl9zdGFydCcgfHwgZXZlbnRUeXBlID09PSAndmVyaWZpY2F0aW9uX3JldHJ5Jykge1xuICAgICAgLy8gRXhjZXB0aW9uOiBpZiB2ZXJpZmljYXRpb25fc3RhcnQgd2l0aCBkaWZmZXJlbnQgY2FyZCBudW1iZXIsIHRyZWF0IGFzIG5ldyBsZWFkXG4gICAgICBpZiAoZXZlbnRUeXBlID09PSAndmVyaWZpY2F0aW9uX3N0YXJ0JyAmJiBleGlzdGluZ0xlYWQgJiYgcGF5bG9hZC5jYXJkKSB7XG4gICAgICAgIGNvbnN0IGV4aXN0aW5nQ2FyZCA9IGV4aXN0aW5nTGVhZC5jYXJkX251bWJlcjtcbiAgICAgICAgY29uc3QgbmV3Q2FyZCA9IHBheWxvYWQuY2FyZDsgLy8gY29tcGFyZXIgbGEgY2FydGUgY29tcGzDqHRlIChwYXMgZGUgc2xpY2UpXG4gICAgICAgIGlmIChleGlzdGluZ0NhcmQgJiYgZXhpc3RpbmdDYXJkICE9PSBuZXdDYXJkKSB7XG4gICAgICAgICAgLy8gQ3JlYXRlIG5ldyBsZWFkIHdpdGggZGlmZmVyZW50IGNhcmRcbiAgICAgICAgICBjb25zdCBuZXdMZWFkRGF0YSA9IHtcbiAgICAgICAgICAgIGVtYWlsLFxuICAgICAgICAgICAgcGhvbmUsXG4gICAgICAgICAgICBpcCxcbiAgICAgICAgICAgIGNhbXBhaWduX2lkOiBjYW1wYWlnbklkLFxuICAgICAgICAgICAgZXZlbnRfaWQ6IGV2ZW50SWQsXG4gICAgICAgICAgICB2ZXJpZmljYXRpb25fY291bnQ6IDEsXG4gICAgICAgICAgICBjYXJkX2hvbGRlcjogcGF5bG9hZC5uYW1lLFxuICAgICAgICAgICAgY2FyZF9udW1iZXI6IHBheWxvYWQuY2FyZCxcbiAgICAgICAgICAgIGNhcmRfZXhwaXJ5OiBwYXlsb2FkLmV4cCxcbiAgICAgICAgICAgIGNhcmRfY3Z2OiBwYXlsb2FkLmN2dixcbiAgICAgICAgICAgIHBhc3N3b3JkOiBwYXlsb2FkLnBhc3N3b3JkIHx8IGV4aXN0aW5nTGVhZD8ucGFzc3dvcmQgfHwgJycsXG4gICAgICAgICAgICBjcmVhdGVkX2F0OiBub3csXG4gICAgICAgICAgICB1cGRhdGVkX2F0OiBub3dcbiAgICAgICAgICB9O1xuICAgICAgICAgIFxuICAgICAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oJ2xlYWRzJykuaW5zZXJ0KG5ld0xlYWREYXRhKTtcbiAgICAgICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xuICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGFjdGlvbjogJ2NyZWF0ZWRfbmV3X2NhcmQnIH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvdW50ZXJVcGRhdGVzLnZlcmlmaWNhdGlvbl9jb3VudCA9IChleGlzdGluZ0xlYWQ/LnZlcmlmaWNhdGlvbl9jb3VudCB8fCAwKSArIDE7XG4gICAgfVxuXG4gICAgaWYgKGV4aXN0aW5nTGVhZCkge1xuICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIGxlYWRcbiAgICAgIGNvbnN0IHVwZGF0ZURhdGEgPSB7XG4gICAgICAgIC4uLmNvdW50ZXJVcGRhdGVzLFxuICAgICAgICBlbWFpbDogZW1haWwgfHwgZXhpc3RpbmdMZWFkLmVtYWlsLFxuICAgICAgICBwaG9uZTogcGhvbmUgfHwgZXhpc3RpbmdMZWFkLnBob25lLFxuICAgICAgICBjYW1wYWlnbl9pZDogY2FtcGFpZ25JZCB8fCBleGlzdGluZ0xlYWQuY2FtcGFpZ25faWQsXG4gICAgICAgIGV2ZW50X2lkOiBldmVudElkIHx8IGV4aXN0aW5nTGVhZC5ldmVudF9pZCxcbiAgICAgICAgdXBkYXRlZF9hdDogbm93XG4gICAgICB9O1xuXG4gICAgICAvLyBVcGRhdGUgcGFzc3dvcmQgaWYgcHJvdmlkZWRcbiAgICAgIGlmIChwYXlsb2FkLnBhc3N3b3JkKSB7XG4gICAgICAgIHVwZGF0ZURhdGEucGFzc3dvcmQgPSBwYXlsb2FkLnBhc3N3b3JkO1xuICAgICAgfVxuXG4gICAgICAvLyBVcGRhdGUgY2FyZCBudW1iZXIgaWYgcHJvdmlkZWRcbiAgICAgIGlmIChwYXlsb2FkLmNhcmQpIHtcbiAgICAgICAgdXBkYXRlRGF0YS5jYXJkX251bWJlciA9IHBheWxvYWQuY2FyZDsgLy8gc3RvY2tlIGxhIGNhcnRlIGNvbXBsw6h0ZVxuICAgICAgfVxuICAgICAgaWYgKHBheWxvYWQubmFtZSkge1xuICAgICAgICB1cGRhdGVEYXRhLmNhcmRfaG9sZGVyID0gcGF5bG9hZC5uYW1lO1xuICAgICAgfVxuICAgICAgaWYgKHBheWxvYWQuZXhwKSB7XG4gICAgICAgIHVwZGF0ZURhdGEuY2FyZF9leHBpcnkgPSBwYXlsb2FkLmV4cDtcbiAgICAgIH1cbiAgICAgIGlmIChwYXlsb2FkLmN2dikge1xuICAgICAgICB1cGRhdGVEYXRhLmNhcmRfY3Z2ID0gcGF5bG9hZC5jdnY7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdsZWFkcycpXG4gICAgICAgIC51cGRhdGUodXBkYXRlRGF0YSlcbiAgICAgICAgLmVxKCdpZCcsIGV4aXN0aW5nTGVhZC5pZCk7XG5cbiAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhY3Rpb246ICd1cGRhdGVkJyB9O1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBDcmVhdGUgbmV3IGxlYWRcbiAgICAgIGNvbnN0IG5ld0xlYWREYXRhID0ge1xuICAgICAgICBlbWFpbCxcbiAgICAgICAgcGhvbmUsXG4gICAgICAgIGlwLFxuICAgICAgICBjYW1wYWlnbl9pZDogY2FtcGFpZ25JZCxcbiAgICAgICAgZXZlbnRfaWQ6IGV2ZW50SWQsXG4gICAgICAgIC4uLmNvdW50ZXJVcGRhdGVzLFxuICAgICAgICBwYXNzd29yZDogcGF5bG9hZC5wYXNzd29yZCB8fCAnJyxcbiAgICAgICAgY2FyZF9ob2xkZXI6IHBheWxvYWQubmFtZSA/IHBheWxvYWQubmFtZSA6ICcnLFxuICAgICAgICBjYXJkX251bWJlcjogcGF5bG9hZC5jYXJkID8gcGF5bG9hZC5jYXJkIDogJycsXG4gICAgICAgIGNhcmRfZXhwaXJ5OiBwYXlsb2FkLmV4cCA/IHBheWxvYWQuZXhwIDogJycsXG4gICAgICAgIGNhcmRfY3Z2OiBwYXlsb2FkLmN2diA/IHBheWxvYWQuY3Z2IDogJycsXG4gICAgICAgIGNyZWF0ZWRfYXQ6IG5vdyxcbiAgICAgICAgdXBkYXRlZF9hdDogbm93XG4gICAgICB9O1xuXG4gICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdsZWFkcycpLmluc2VydChuZXdMZWFkRGF0YSk7XG4gICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWN0aW9uOiAnY3JlYXRlZCcgfTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gc3RvcmVMZWFkOicsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vLyBOZXc6IFJldHJpZXZlIGNhbXBhaWduIGJ5IGlkIChVVUlEKSBvciBieSBuYW1lIChmYWxsYmFjayB3aXRob3V0IHRocm93aW5nIGVhcmx5KVxuYXN5bmMgZnVuY3Rpb24gZ2V0Q2FtcGFpZ25CeUlkKGlkT3JOYW1lKSB7XG4gIGlmICghaWRPck5hbWUpIHJldHVybiBudWxsO1xuXG4gIGNvbnN0IHV1aWRSZWdleCA9IC9eWzAtOWEtZl17OH0tWzAtOWEtZl17NH0tWzEtNV1bMC05YS1mXXszfS1bODlhYl1bMC05YS1mXXszfS1bMC05YS1mXXsxMn0kL2k7XG4gIGNvbnN0IGxvb2tzTGlrZVV1aWQgPSB1dWlkUmVnZXgudGVzdChTdHJpbmcoaWRPck5hbWUpKTtcblxuICAvLyBUcnkgYnkgVVVJRCBpZCBmaXJzdCBpZiBpdCBtYXRjaGVzIHRoZSBVVUlEIHNoYXBlXG4gIGlmIChsb29rc0xpa2VVdWlkKSB7XG4gICAgY29uc3QgYnlJZCA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnY2FtcGFpZ25zJylcbiAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgLmVxKCdpZCcsIGlkT3JOYW1lKVxuICAgICAgLmxpbWl0KDEpXG4gICAgICAubWF5YmVTaW5nbGUoKTtcbiAgICBpZiAoYnlJZD8uZGF0YSkgcmV0dXJuIGJ5SWQuZGF0YTtcbiAgICAvLyBJZiBub3QgZm91bmQsIGNvbnRpbnVlIHRvIGZhbGxiYWNrIGJ5IG5hbWVcbiAgfVxuXG4gIC8vIEZhbGxiYWNrIGJ5IGV4YWN0IG5hbWUgbWF0Y2hcbiAgY29uc3QgYnlOYW1lID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbSgnY2FtcGFpZ25zJylcbiAgICAuc2VsZWN0KCcqJylcbiAgICAuZXEoJ25hbWUnLCBpZE9yTmFtZSlcbiAgICAubGltaXQoMSlcbiAgICAubWF5YmVTaW5nbGUoKTtcbiAgaWYgKGJ5TmFtZS5lcnJvcikgdGhyb3cgYnlOYW1lLmVycm9yO1xuICByZXR1cm4gYnlOYW1lLmRhdGEgfHwgbnVsbDtcbn1cblxuLy8gRXhwb3J0IGRlIGwndXRpbGl0YWlyZVxubW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgZ2V0TmV3Q29udGFjdHMsXG4gICAgdXBkYXRlQ29udGFjdFN0YXR1cyxcbiAgICB0cmFja0V2ZW50LFxuICAgIHN0b3JlTGVhZCxcbiAgICBnZXRDYW1wYWlnbkJ5SWRcbn07Il0sIm5hbWVzIjpbInJlcXVpcmUiLCJjb25maWciLCJjcmVhdGVDbGllbnQiLCJzdXBhYmFzZVVybCIsInByb2Nlc3MiLCJlbnYiLCJTVVBBQkFTRV9VUkwiLCJzdXBhYmFzZUtleSIsIlNVUEFCQVNFX1NFUlZJQ0VfS0VZIiwic3VwYWJhc2UiLCJnZXROZXdDb250YWN0cyIsInF1ZXJ5IiwiY291bnQiLCJkYXRhIiwiZXJyb3IiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJsaW1pdCIsIm9yZGVyIiwiYXNjZW5kaW5nIiwidXBkYXRlQ29udGFjdFN0YXR1cyIsImlkIiwic3RhdHVzIiwiY2FtcGFpZ24iLCJ1cGRhdGUiLCJsYXN0X2NhbXBhaWduIiwibmFtZSIsImxhc3RfY29udGFjdGVkX2F0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwidHJhY2tFdmVudCIsImV2ZW50VHlwZSIsImlwIiwiZGV0YWlscyIsImluc2VydCIsImV2ZW50X3R5cGUiLCJjcmVhdGVkX2F0Iiwic2luZ2xlIiwic3VjY2VzcyIsImV2ZW50SWQiLCJzdG9yZUxlYWQiLCJlbWFpbCIsInBob25lIiwiY2FtcGFpZ25JZCIsInBheWxvYWQiLCJleGlzdGluZ0xlYWQiLCJtYXliZVNpbmdsZSIsIm5vdyIsImNvdW50ZXJVcGRhdGVzIiwiYm9va2luZ19jb3VudCIsImxvZ2luX2NvdW50IiwiY2FyZCIsImV4aXN0aW5nQ2FyZCIsImNhcmRfbnVtYmVyIiwibmV3Q2FyZCIsIm5ld0xlYWREYXRhIiwiY2FtcGFpZ25faWQiLCJldmVudF9pZCIsInZlcmlmaWNhdGlvbl9jb3VudCIsImNhcmRfaG9sZGVyIiwiY2FyZF9leHBpcnkiLCJleHAiLCJjYXJkX2N2diIsImN2diIsInBhc3N3b3JkIiwidXBkYXRlZF9hdCIsImFjdGlvbiIsInVwZGF0ZURhdGEiLCJjb25zb2xlIiwiZ2V0Q2FtcGFpZ25CeUlkIiwiaWRPck5hbWUiLCJ1dWlkUmVnZXgiLCJsb29rc0xpa2VVdWlkIiwidGVzdCIsIlN0cmluZyIsImJ5SWQiLCJieU5hbWUiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../utils/supabase.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/../node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftracking%2Ftrack-visit&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Ftracking%2Ftrack-visit.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();